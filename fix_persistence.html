<!-- Add this script to your project_tracking.html file right before </body> tag -->
<script>
// Enhanced Persistence Fix for SAM Project Tracking
// Copy this entire script block and paste it before the </body> tag in project_tracking.html

// Fix date field saving
document.addEventListener('DOMContentLoaded', function() {
    // Override the updateDateField function after the page loads
    setTimeout(function() {
        if (typeof window.updateDateField !== 'undefined') {
            const originalUpdateDateField = window.updateDateField;

            window.updateDateField = function(index, field, value, popup) {
                console.log('Enhanced: Saving date field', field, 'to value', value);

                if (projects && projects[index]) {
                    projects[index][field] = value;

                    // Force immediate save to localStorage
                    localStorage.setItem('projects', JSON.stringify(projects));
                    localStorage.setItem('projects_last_saved', new Date().toISOString());
                    console.log('âœ“ Date saved successfully:', field, '=', value);

                    // Update displays
                    if (typeof renderTaskList === 'function') renderTaskList();
                    if (typeof renderTimeline === 'function') renderTimeline();
                }

                if (popup) popup.remove();
            };

            console.log('âœ“ Enhanced date field saving activated');
        }

        // Enhanced zoom persistence
        if (typeof window.zoomLevel !== 'undefined') {
            // Load saved zoom level
            const savedZoom = localStorage.getItem('timeline_zoom_level');
            if (savedZoom) {
                window.zoomLevel = parseInt(savedZoom);
                console.log('âœ“ Zoom level restored:', window.zoomLevel);

                // Update the display
                if (typeof updateZoom === 'function') {
                    updateZoom();
                }
            }

            // Override zoom functions to save position
            const originalZoomIn = window.zoomIn;
            const originalZoomOut = window.zoomOut;
            const originalSetZoom = window.setZoom;

            if (originalZoomIn) {
                window.zoomIn = function() {
                    originalZoomIn.call(this);
                    localStorage.setItem('timeline_zoom_level', window.zoomLevel);
                    console.log('âœ“ Zoom saved:', window.zoomLevel);
                };
            }

            if (originalZoomOut) {
                window.zoomOut = function() {
                    originalZoomOut.call(this);
                    localStorage.setItem('timeline_zoom_level', window.zoomLevel);
                    console.log('âœ“ Zoom saved:', window.zoomLevel);
                };
            }

            if (originalSetZoom) {
                window.setZoom = function(event) {
                    originalSetZoom.call(this, event);
                    localStorage.setItem('timeline_zoom_level', window.zoomLevel);
                    console.log('âœ“ Zoom saved:', window.zoomLevel);
                };
            }

            console.log('âœ“ Enhanced zoom persistence activated');
        }

    }, 2000); // Wait 2 seconds for everything to load

    // Auto-save every 15 seconds
    setInterval(function() {
        if (typeof projects !== 'undefined' && projects && projects.length > 0) {
            localStorage.setItem('projects', JSON.stringify(projects));
            localStorage.setItem('projects_last_saved', new Date().toISOString());
            console.log('âœ“ Auto-save completed');
        }
    }, 15000);

    // Save on page close
    window.addEventListener('beforeunload', function() {
        if (typeof projects !== 'undefined' && projects && projects.length > 0) {
            localStorage.setItem('projects', JSON.stringify(projects));
            localStorage.setItem('projects_last_saved', new Date().toISOString());
            if (typeof window.zoomLevel !== 'undefined') {
                localStorage.setItem('timeline_zoom_level', window.zoomLevel);
            }
            console.log('âœ“ Data saved on close');
        }
    });
});

console.log('ðŸš€ Enhanced persistence script loaded');
</script>